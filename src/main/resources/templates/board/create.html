<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>글 작성</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function(){
		$.ajaxSetup({
		    headers: {
		        'X-CSRF-TOKEN': $('input[name="_csrf"]').val() // CSRF 토큰
		    }
		});
		
		$('#submitBtn').on('click', function(){
			const urlParts = window.location.pathname.split('/');
			if (urlParts.length > 0) {
				const boardId = urlParts[urlParts.length - 1];
				const title = $('#title').val();
				const content = $('#content').val();
				$.ajax({
					url: "/board/update/" + boardId,
					type: "PUT",
					data: JSON.stringify({
						title: title,
						content: content
					}),
					contentType: "application/json",
					success: function(response) {
						alert('게시글이 수정되었습니다.');
						location.href = '/board/detail/' + boardId;
					},
					error: function(xhr, status, error) {
						alert('수정 중 오류가 발생했습니다.' + xhr.responseText);
					}
				});
			}
		});
	});
</script>
</head>
<body>
	<main>
		<form th:object="${addReqDTO}">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"	/>
			<div th:replace="~{/fragments/errorMessages :: errorFragment}"></div>
			<div>
				<label for="title">글 제목</label>
				<input type="text" th:field="*{title}" id="title"	/>
			</div>
			<div>
				<label for="content">글 내용</label>
				<textarea th:field="*{content}" id="content" rows="10" cols="30"></textarea>
			</div>
			<button type="button" id="submitBtn">등록</button>
		</form>
	</main>
</body>
</html>