<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>게시판</title>
<style>
	.disabled {
		pointer-events: none;
		opacity: 0.5;
	}
	.active {
		font-weight: bold;
		pointer-events: none;
		color: purple;
	}
	.pages {
		text-decoration-line: none;
	}
</style>
</head>
<body>
	<main>
		<section>
			<h1>검색</h1>
		 	<input type="text" id="search_kw" th:value="${kw}">
		 	<button type="button" id="btn_search">검색</button>
		</section>
		
		<section>
			<h3>메뉴</h3>
		 	<a th:href="@{/board/create}">글쓰기</a>
			<a sec:authorize="isAuthenticated()" href="/user/logout" th:text="'로그아웃'"></a>
			<a sec:authorize="isAnonymous()" href="/user/login" th:text="'로그인'"></a>
		</section>
		
		<section>
			<h1>목록</h1>
			<table>
				<thead>
					<tr>
						<th>글번호</th>
						<th>제목</th>
						<th>작성자</th>
						<th>작성일</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="board, loop : ${paging}">
						<td th:text="${paging.getTotalElements - (paging.number * paging.size) - loop.index}"></td>
						<td>
							<a th:href="@{|/board/detail/${board.id}|}" th:text="${board.title}"></a>
						</td>
						<td>
							<span th:if="${board.author != null}" th:text="${board.author.username}"></span>
						</td>
						<td th:text="${#temporals.format(board.createDate, 'yyyy-MM-dd HH:mm')}"></td>
					</tr>
				</tbody>
			</table>
		</section>
		
		<section>
			<h4>페이징 처리</h4>
				<span th:if="${pageResDTO.startPage > 10}">
					<a th:href="@{|/board/list?page=${pageResDTO.startPage - 10}|}" th:text="'[이전]'"></a>
				</span>
				
				<span th:each="i : ${#numbers.sequence(pageResDTO.startPage, pageResDTO.endPage)}">
					<a th:if="${paging.number != i}" th:href="@{|/board/list?page=${i}|}" th:text="'['+${i}+']'"></a>
					<span th:if="${paging.number == i}">
						[<b style="color: darkgray;" th:text="${i}"></b>]
					</span>
				</span>
				
				<span th:if="${pageResDTO.endPage < pageResDTO.totalPages}">
					<a th:href="@{|/board/list?page=${pageResDTO.startPage + 10}|}" th:text="'[다음]'"></a>
				</span>
			
			
			
<!-- 				<div> -->
<!-- 					[[${paging.number}]] [[${paging.totalPages}]] -->
<!-- 					[[${paging.getSize()}]] [[${paging.getTotalElements()}]]  -->
<!-- 					[[${pageResDTO.startPage}]] [[${pageResDTO.endPage}]] -->
<!-- 					<span th:classappend="${!paging.hasPrevious} ? 'disabled'"> -->
<!-- 						<a class="pages" href="javascript:void(0);" th:data-page="${paging.number - 1}"> -->
<!-- 							<span>이전</span> -->
<!-- 						</a> -->
<!-- 					</span> -->
					
<!-- 					<span th:each="page : ${#numbers.sequence(0, paging.totalPages - 1)}" -->
<!-- 					 th:if="${page >= paging.number - 5 and page <= paging.number + 4}" -->
<!-- 					 th:classappend="${page == paging.number} ? 'active'"> -->
<!-- 						<a th:text="${page + 1}" class="pages" href="javascript:void(0);" th:data-page="${page}"></a> -->
<!-- 					</span> -->
					
<!-- 					<span th:classappend="${!paging.hasNext} ? 'disabled'"> -->
<!-- 						<a class="pages" href="javascript:void(0);" th:data-page="${paging.number + 1}"> -->
<!-- 							<span>다음</span> -->
<!-- 						</a> -->
<!-- 					</span> -->
<!-- 				</div> -->
<!-- 			</div> -->
		</section>
		
		<form th:action="@{/board/list}" method="get" id="searchForm">
			<input type="hidden" id="kw" name="kw" th:value="${kw}">
			<input type="hidden" id="page" name="page" th:value="${paging.number}">
		</form>
	</main>
	<script>
// 		const page_elements = document.getElementsByClassName('pages');
// 		Array.from(page_elements).forEach(function(element) {
// 			element.addEventListener('click', function() {
// 				document.getElementById('page').value = this.dataset.page;
// 				document.getElementById('searchForm').submit();
// 			});
// 		});
	</script>
</body>
</html>